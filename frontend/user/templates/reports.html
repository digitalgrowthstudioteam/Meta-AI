{% extends "user/templates/user_base.html" %}

{% block title %}Reports | Digital Growth Studio{% endblock %}

{% block page_title %}
Reports
{% endblock %}

{% block content %}

<div class="audience-container">

    <!-- ================= AI Explainability Banner ================= -->
    <div class="ai-info-banner">
        <strong>Performance & AI Reports</strong>
        <p>
            Reports provide read-only visibility into campaign performance,
            AI actions, and outcome trends.
        </p>
    </div>

    <!-- ================= Summary Cards ================= -->
    <div class="audience-grid">

        <div class="audience-card info">
            <h3>Total Campaigns</h3>
            <p class="audience-metric" id="total-campaigns">—</p>
            <p class="audience-note">All fetched campaigns</p>
            <span class="confidence medium">Live</span>
        </div>

        <div class="audience-card positive">
            <h3>AI-Active Campaigns</h3>
            <p class="audience-metric" id="ai-active-campaigns">—</p>
            <p class="audience-note">Optimized by AI</p>
            <span class="confidence high">High Confidence</span>
        </div>

        <div class="audience-card warning">
            <h3>Lead vs Sales</h3>
            <p class="audience-metric">
                <span id="lead-campaigns">—</span> Leads ·
                <span id="sales-campaigns">—</span> Sales
            </p>
            <p class="audience-note">Objective split</p>
            <span class="confidence medium">Derived</span>
        </div>

    </div>

    <!-- ================= Campaign-level Reports ================= -->
    <div class="audience-section">
        <h2 class="section-title">Campaign-level Reports</h2>

        <div id="campaign-empty" class="empty-state">
            <p>No campaign reports available yet.</p>
            <p class="muted">
                Campaign-level data will appear once performance data
                and AI actions are recorded.
            </p>
        </div>

        <table id="campaign-table" class="report-table" style="display:none;">
            <thead>
                <tr>
                    <th>Campaign Name</th>
                    <th>Objective</th>
                    <th>AI Status</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="campaign-rows"></tbody>
        </table>
    </div>

</div>

<script>
(async function loadReports() {
    try {
        /* ---------- OVERVIEW ---------- */
        const overviewRes = await fetch("/api/reports/overview");
        const overviewJson = await overviewRes.json();
        const o = overviewJson.data || {};

        document.getElementById("total-campaigns").innerText = o.total_campaigns ?? 0;
        document.getElementById("ai-active-campaigns").innerText = o.ai_active_campaigns ?? 0;
        document.getElementById("lead-campaigns").innerText = o.lead_campaigns ?? 0;
        document.getElementById("sales-campaigns").innerText = o.sales_campaigns ?? 0;

        /* ---------- CAMPAIGNS ---------- */
        const campaignRes = await fetch("/api/reports/campaigns");
        const campaignJson = await campaignRes.json();
        const campaigns = campaignJson.campaigns || [];

        if (campaigns.length > 0) {
            document.getElementById("campaign-empty").style.display = "none";
            document.getElementById("campaign-table").style.display = "table";

            const tbody = document.getElementById("campaign-rows");

            campaigns.forEach(c => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${c.name}</td>
                    <td>${c.objective}</td>
                    <td>${c.ai_active ? "AI-Active" : "Inactive"}</td>
                    <td>${c.status}</td>
                `;
                tbody.appendChild(row);
            });
        }

    } catch (err) {
        console.error("Reports load error", err);
    }
})();
</script>

{% endblock %}
